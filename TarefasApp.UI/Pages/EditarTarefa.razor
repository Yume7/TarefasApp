@page "/editar-tarefa/{id:guid}"
@using TarefasApp.Domain.DTOs.Responses
@using TarefasApp.Domain.DTOs.Requests

@inject TarefaService TarefaService
@inject NavigationManager Navigation

<h3>Editar Tarefa</h3>

@if (tarefa == null)
{
    <p>Carregando...</p>
}
else
{
    <div class="card p-4">
        <div class="form-group mb-2">
            <label>Título</label>
            <input @bind="tarefa.Titulo" class="form-control" />
        </div>

        <div class="form-group mb-2">
            <label>Descrição</label>
            <textarea @bind="tarefa.Descricao" class="form-control"></textarea>
        </div>

        <div class="form-group mb-2">
            <label>Data</label>
            <input type="date" @bind="tarefa.Data" class="form-control" />
        </div>

        <div class="form-group mb-3">
            <label>Status</label>
            <select @bind="tarefa.Status" class="form-control">
                <option value="0">Pendente</option>
                <option value="1">Concluída</option>
            </select>
        </div>

        <button class="btn btn-primary" @onclick="AtualizarTarefa">Salvar Alterações</button>
        <button class="btn btn-danger ms-2" @onclick="ExcluirTarefa">Excluir</button>
    </div>
}

@code {
    [Parameter] public Guid Id { get; set; }
    private TarefaResponseDTO tarefa = new();

    protected override async Task OnInitializedAsync()
    {
        var tarefaResult = await TarefaService.ObterPorId(Id);

        if (tarefaResult != null)
        {
            tarefa = tarefaResult;
        }
        else
        {
            Navigation.NavigateTo("/tarefas");
        }
    }

    private async Task AtualizarTarefa()
    {
        var tarefaRequest = new TarefaRequestDTO
            {
                Titulo = tarefa.Titulo,
                Descricao = tarefa.Descricao,
                Data = tarefa.Data,
                Status = tarefa.Status
            };

        await TarefaService.Atualizar(Id, tarefaRequest);
        Navigation.NavigateTo("/tarefas");
    }

    private async Task ExcluirTarefa()
    {
        await TarefaService.Deletar(Id);
        Navigation.NavigateTo("/tarefas");
    }
}
